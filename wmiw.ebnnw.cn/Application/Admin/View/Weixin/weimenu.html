<include file="Common:meta" />
<title>编辑微信自定义菜单-{$site.SITE_INFO.name}</title>
<meta name="description" content="{$site.SITE_INFO.keyword}">
<meta name="keywords" content="{$site.SITE_INFO.description}">
<include file="Common:link" />
<body data-type="widgets">
    <div class="am-g tpl-g">
        <!-- 头部 -->
        <include file="Common:header" />
        <!-- 内容区域 -->
        <div class="tpl-content-wrapper">
            <div class="container-fluid">
                <p class="page-header-description">
                    <strong>注意：</strong>
                    1、自定义菜单最多包括3个一级菜单，每个一级菜单最多包含5个二级菜单。<br/>
                    2、一级菜单最多4个汉字，二级菜单最多7个汉字，多出来的部分将会以“...”代替。<br/>
                    3、创建自定义菜单后，菜单的刷新策略是，在用户进入公众号会话页或公众号profile页时，如果发现上一次拉取菜单的请求在5分钟以前，就会拉取一下菜单，如果菜单有更新，就会刷新客户端的菜单。测试时可以尝试取消关注公众账号后再次关注，则可以看到创建后的效果。<br/>
                    4、以下菜单都可以选填，不填写则不进行设置；设置二级菜单必须设置一级菜单的菜单名称，否则不予处理。<br/>
                </p>
            </div>
            <div class="row-content am-cf">
                <div class="row">
                    <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">
                        <div class="widget am-cf">
                            <div class="widget-head am-cf">
                                <div class="widget-title am-fl">编辑微信自定义菜单</div>
                            </div>

                            <div class="widget-body am-fr">
                                <form id="weimenuForm" class="am-form tpl-form-border-form tpl-form-border-br">
                                    <div class="am-form-group">
                                        <label for="name" class="am-u-sm-3 am-form-label">菜单（一）</label>
                                        <div class="am-u-sm-9 wei-menu">
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">一级菜单名称</div><input type="text" class="input" name="weimenu[0][0][name]" value="{$weimenu.0.0.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[0][0][url]" value="{$weimenu.0.0.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[0][0][type]" value="view"/>
                                                </ul>
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">二级菜单名称</div><input type="text" class="input" name="weimenu[0][1][name]" value="{$weimenu.0.1.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[0][1][url]" value="{$weimenu.0.1.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[0][1][type]" value="view"/>
                                                </ul>
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">二级菜单名称</div><input type="text" class="input" name="weimenu[0][2][name]" value="{$weimenu.0.2.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[0][2][url]" value="{$weimenu.0.2.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[0][2][type]" value="view"/>
                                                </ul>
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">二级菜单名称</div><input type="text" class="input" name="weimenu[0][3][name]" value="{$weimenu.0.3.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[0][3][url]" value="{$weimenu.0.3.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[0][3][type]" value="view"/>
                                                </ul>
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">二级菜单名称</div><input type="text" class="input" name="weimenu[0][4][name]" value="{$weimenu.0.4.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[0][4][url]" value="{$weimenu.0.4.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[0][4][type]" value="view"/>
                                                </ul>
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">二级菜单名称</div><input type="text" class="input" name="weimenu[0][5][name]" value="{$weimenu.0.5.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[0][5][url]" value="{$weimenu.0.5.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[0][5][type]" value="view"/>
                                                </ul>
                                        </div>
                                    </div>
                                    <div class="am-form-group">
                                        <label for="name" class="am-u-sm-3 am-form-label">菜单（二）</label>
                                        <div class="am-u-sm-9 wei-menu">
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">一级菜单名称</div><input type="text" class="input" name="weimenu[1][0][name]" value="{$weimenu.1.0.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[1][0][url]" value="{$weimenu.1.0.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[1][0][type]" value="view"/>
                                                </ul>
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">二级菜单名称</div><input type="text" class="input" name="weimenu[1][1][name]" value="{$weimenu.1.1.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[1][1][url]" value="{$weimenu.1.1.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[1][1][type]" value="view"/>
                                                </ul>
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">二级菜单名称</div><input type="text" class="input" name="weimenu[1][2][name]" value="{$weimenu.1.2.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[1][2][url]" value="{$weimenu.1.2.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[1][2][type]" value="view"/>
                                                </ul>
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">二级菜单名称</div><input type="text" class="input" name="weimenu[1][3][name]" value="{$weimenu.1.3.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[1][3][url]" value="{$weimenu.1.3.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[1][3][type]" value="view"/>
                                                </ul>
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">二级菜单名称</div><input type="text" class="input" name="weimenu[1][4][name]" value="{$weimenu.1.4.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[1][4][url]" value="{$weimenu.1.4.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[1][4][type]" value="view"/>
                                                </ul>
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">二级菜单名称</div><input type="text" class="input" name="weimenu[1][5][name]" value="{$weimenu.1.5.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[1][5][url]" value="{$weimenu.1.5.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[1][5][type]" value="view"/>
                                                </ul>
                                        </div>
                                    </div>
                                    <div class="am-form-group">
                                        <label for="name" class="am-u-sm-3 am-form-label">菜单（三）</label>
                                        <div class="am-u-sm-9 wei-menu">
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">一级菜单名称</div><input type="text" class="input" size="20" name="weimenu[2][0][name]" value="{$weimenu.2.0.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[2][0][url]" value="{$weimenu.2.0.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[2][0][type]" value="view"/>
                                                </ul>
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">二级菜单名称</div><input type="text" class="input" size="20" name="weimenu[2][1][name]" value="{$weimenu.2.1.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[2][1][url]" value="{$weimenu.2.1.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[2][1][type]" value="view"/>
                                                </ul>
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">二级菜单名称</div><input type="text" class="input" size="20" name="weimenu[2][2][name]" value="{$weimenu.2.2.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[2][2][url]" value="{$weimenu.2.2.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[2][2][type]" value="view"/>
                                                </ul>
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">二级菜单名称</div><input type="text" class="input" size="20" name="weimenu[2][3][name]" value="{$weimenu.2.3.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[2][3][url]" value="{$weimenu.2.3.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[2][3][type]" value="view"/>
                                                </ul>
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">二级菜单名称</div><input type="text" class="input" size="20" name="weimenu[2][4][name]" value="{$weimenu.2.4.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[2][4][url]" value="{$weimenu.2.4.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[2][4][type]" value="view"/>
                                                </ul>
                                                <ul class="am-avg-sm-2">
                                                    <li><div class="on-txt">二级菜单名称</div><input type="text" class="input" size="20" name="weimenu[2][5][name]" value="{$weimenu.2.5.name}"/></li>
                                                    <li><div class="on-txt">跳转页面</div><input type="text" class="input" size="60" name="weimenu[2][5][url]" value="{$weimenu.2.5.url}"/></li>
                                                    <input type="hidden" class="input" size="60" name="weimenu[2][5][type]" value="view"/>
                                                </ul>
                                        </div>
                                    </div>
                                    <div class="am-form-group">
                                        <div class="am-u-sm-9 am-u-sm-push-3">
                                            <input type="submit" name="" value="保存" class="am-btn am-btn-primary tpl-btn-bg-color-success submitBtn">
                                            <input type="submit" name="" value="更新微信菜单" class="am-btn am-btn-secondary tpl-btn-bg-color-success setSubmitBtn">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
<include file="Common:footer_link" />
<style type="text/css">
    .wei-menu ul{ margin-bottom: 5px;}
    .wei-menu li{ position: relative; padding-left: 110px;}
    .wei-menu .on-txt{left: 0; line-height: 35px;
    position: absolute;
    text-align: right;
    width: 100px;}
</style>
<script type="text/javascript">
    // 表单提交
        var form = $('#weimenuForm');
        var subbtn = $(".submitBtn");
        var testSubbtn = $(".setSubmitBtn");
        var testAjaxUrl = '{:U("Weixin/weimenu")}';
        $(".submitBtn").click(function(){
            ajaxForm(subbtn,form,document.URL,0);
        });

        $(".setSubmitBtn").click(function(){
            ajaxForm(testSubbtn,form,testAjaxUrl,1);
        });

        function ajaxForm(ajaxBtn,form,ajaxUrl,update){
            form.validator({
                submit: function() {
                    var formValidity = this.isFormValid();
                    if (formValidity) {
                        // 验证成功的逻辑
                        ajaxBtn.button('loading');
                        // 验证成功的逻辑
                        form.ajaxSubmit({url:ajaxUrl,data:{"update":update},type:"POST",
                            success:function(data, st) {
                                // 提示框
                                AMUI.dialog.alert({ title: data.title, content: data.info});
                                if(data.status==1){
                                    setTimeout(function(){
                                        top.window.location.href = data.url;
                                    },1000);
                                }else{
                                    ajaxBtn.button('reset');
                                }
                                return false;
                            }
                        });
                    } else {
                        ajaxBtn.button('reset');
                    // 验证失败的逻辑
                    }
                //阻止原生form提交
                return false;
                }
            });
        }
</script>
</body>
</html>